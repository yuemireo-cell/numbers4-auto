<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒŠãƒ³ãƒãƒ¼ã‚º4 ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆäºˆæƒ³ï¼ˆå®Œæˆç‰ˆï¼‰</title>

<style>
body{
  font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif;
  padding:16px;
  max-width:900px;
  margin:auto;
}
h1{font-size:32px;margin-bottom:16px}

input,button{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:14px;
  border:1px solid #ddd;
  margin:6px 0;
}
button{
  background:#111;
  color:#fff;
  font-weight:900;
  border:none;
}

.box{
  background:#fafafa;
  border:1px solid #eee;
  border-radius:16px;
  padding:14px;
  margin-bottom:16px;
}

.grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
}
@media(max-width:600px){
  .grid{grid-template-columns:1fr 1fr;}
}

.cell{
  border:2px solid #111;
  border-radius:14px;
  padding:10px;
  background:#fff;
}
.cell h3{
  margin:0 0 8px;
  text-align:center;
}
.num{
  font-size:26px;
  font-weight:900;
  text-align:center;
  margin:4px 0;
}
.score{
  font-size:12px;
  color:#666;
  text-align:center;
}
</style>
</head>

<body>

<h1>â­ ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆäºˆæƒ³ï¼ˆåŠ ç‚¹å¼ï¼‰</h1>

<div class="box">
  <input id="hit1" inputmode="numeric" placeholder="ãƒ’ãƒ³ãƒˆ1ï¼ˆä¾‹ï¼š168ï¼‰">
  <input id="hit2" inputmode="numeric" placeholder="ãƒ’ãƒ³ãƒˆ2ï¼ˆä¾‹ï¼š3920ï¼‰">
  <input id="prev" inputmode="numeric" placeholder="å‰å›ï¼ˆä¾‹ï¼š9827ï¼‰" maxlength="4">

  <button onclick="saveResult()">ğŸ“¥ æŠ½é¸çµæœã‚’ä¿å­˜</button>
  <button onclick="analyze()">ğŸ”® ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆäºˆæƒ³</button>
</div>

<div class="grid" id="table"></div>

<script>
const ura = {0:5,5:0,1:6,6:1,2:7,7:2,3:8,8:3,4:9,9:4};
const KEY = "numbers4_history";

function getHistory(){
  return JSON.parse(localStorage.getItem(KEY) || "[]");
}

function saveResult(){
  const v = document.getElementById("prev").value;
  if(!/^\d{4}$/.test(v)) return alert("4æ¡ã§å…¥ã‚Œã¦ã­");
  let h = getHistory();
  h.unshift(v);
  if(h.length > 100) h.pop();
  localStorage.setItem(KEY, JSON.stringify(h));
  alert("ä¿å­˜OKï¼ˆç¾åœ¨ " + h.length + " å›ï¼‰");
}

function analyze(){
  const hist = getHistory();
  const score = Array.from({length:4},()=>Array(10).fill(0));

  // éå»100å›
  hist.forEach(n=>{
    [...n].forEach((d,i)=>score[i][+d]++);
  });

  // å‰å›
  const prev = document.getElementById("prev").value;
  if(/^\d{4}$/.test(prev)){
    [...prev].forEach((d,i)=>score[i][+d]+=8);
  }

  // ãƒ’ãƒ³ãƒˆ + è£
  [hit1.value, hit2.value].forEach(h=>{
    [...new Set((h.match(/\d/g)||[]))].forEach(d=>{
      for(let i=0;i<4;i++){
        score[i][+d]+=3;
        score[i][ura[d]]+=5;
      }
    });
  });

  render(score);
}

function render(score){
  const names = ["åƒ","ç™¾","å","ä¸€"];
  const el = document.getElementById("table");
  el.innerHTML = "";

  score.forEach((arr,i)=>{
    const top = arr
      .map((s,n)=>({n,s}))
      .sort((a,b)=>b.s-a.s)
      .slice(0,4);

    const box = document.createElement("div");
    box.className="cell";
    box.innerHTML = `<h3>${names[i]}ã®ä½</h3>` +
      top.map(x=>`<div class="num">${x.n}</div><div class="score">+${x.s}</div>`).join("");
    el.appendChild(box);
  });
}
</script>

</body>
</html>
