<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>NUMBERS4 ANALYZER v1.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  background:#0b1020;
  color:#e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  margin:0;
  padding:16px;
}
h1{font-size:20px;margin-bottom:12px}
button{
  background:#2563eb;
  color:white;
  border:none;
  padding:10px 14px;
  border-radius:8px;
  font-size:14px;
}
.card{
  background:#111827;
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
}
.grid{
  display:grid;
  grid-template-columns: repeat(4,1fr);
  gap:8px;
}
.cell{
  background:#020617;
  border-radius:8px;
  padding:8px;
}
.rank{
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
small{color:#9ca3af}
</style>
</head>

<body>
<h1>NUMBERS4 ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆè§£æ</h1>

<div class="card">
  <button onclick="analyze()">è§£æã™ã‚‹</button>
  <button onclick="saveResult()">ä¿å­˜</button>
</div>

<div id="result"></div>

<script>
/* ===============================
   ğŸ”’ éå»300å›åˆ†ï¼ˆè§£æå°‚ç”¨ï¼‰
   â€» è¡¨ç¤ºãƒ»UIåˆ©ç”¨ä¸€åˆ‡ãªã—
   =============================== */

// â€»ã“ã“ã«ã€Œã™ã§ã«ãƒ†ã‚­ã‚¹ãƒˆåŒ–ã—ãŸ300å›åˆ†ã€ã‚’
// ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ã„ã‚‹å‰æ
// å½¢å¼: [{round:6609, num:"9827"}, ... ]

const HISTORY_300 = JSON.parse(localStorage.getItem("HISTORY_300")) || [];

/* ===============================
   ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
   =============================== */
const digits = n => n.split("").map(v=>+v);
const rev = n => n.map(d => (9-d));

/* ===============================
   è§£æãƒ­ã‚¸ãƒƒã‚¯
   =============================== */
function analyze(){
  if(HISTORY_300.length < 100){
    alert("è§£æç”¨ãƒ‡ãƒ¼ã‚¿ä¸è¶³");
    return;
  }

  const posFreq = Array.from({length:4},()=>Array(10).fill(0));
  const lastSeen = Array.from({length:4},()=>Array(10).fill(null));
  const transition = Array.from({length:4},()=>Array.from({length:10},()=>Array(10).fill(0)));

  HISTORY_300.forEach((h,i)=>{
    const d = digits(h.num);
    d.forEach((v,p)=>{
      posFreq[p][v]++;
      if(i>0){
        const prev = digits(HISTORY_300[i-1].num)[p];
        transition[p][prev][v]++;
      }
      lastSeen[p][v]=i;
    });
  });

  const recent10 = HISTORY_300.slice(0,10).map(h=>digits(h.num));

  const score = Array.from({length:4},()=>Array(10).fill(0));

  for(let p=0;p<4;p++){
    for(let n=0;n<10;n++){
      score[p][n]+=posFreq[p][n]*0.5;

      // å‡ºç¾é–“éš”
      const gap = lastSeen[p][n];
      if(gap!==null) score[p][n]+=Math.max(0,20-gap);

      // é·ç§»
      const prevDigit = recent10[0][p];
      score[p][n]+=transition[p][prevDigit][n]*2;

      // ãƒŠãƒ³ã¡ã‚ƒã‚“æ³•å‰‡
      if(rev([n]).includes(prevDigit)) score[p][n]+=3;
      if(Math.abs(n-prevDigit)<=2) score[p][n]+=2;
    }
  }

  render(score);
}

function render(score){
  const posName=["åƒ","ç™¾","å","ä¸€"];
  let html="";
  score.forEach((arr,p)=>{
    const ranked = arr
      .map((v,i)=>({n:i,s:v}))
      .sort((a,b)=>b.s-a.s)
      .slice(0,4);

    html+=`
      <div class="card">
        <strong>${posName[p]}ã®ä½</strong>
        ${ranked.map(r=>`
          <div class="rank">
            <span>${r.n}</span>
            <small>+${r.s.toFixed(1)}</small>
          </div>
        `).join("")}
      </div>
    `;
  });
  document.getElementById("result").innerHTML=html;
}

/* ===============================
   ä¿å­˜å‡¦ç†
   =============================== */
function saveResult(){
  const input = prompt("ä»Šå›ã®å½“é¸æ•°å­—ï¼ˆ4æ¡ï¼‰");
  if(!input || input.length!==4) return;

  HISTORY_300.unshift({round:null,num:input});
  if(HISTORY_300.length>300) HISTORY_300.pop();

  localStorage.setItem("HISTORY_300",JSON.stringify(HISTORY_300));
  alert("ä¿å­˜å®Œäº†ï¼ˆprev/prev2 è‡ªå‹•æ›´æ–°ï¼‰");
}
</script>
</body>
</html>
